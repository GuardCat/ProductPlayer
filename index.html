<!doctype HTML>
<html>
<head>
	<link rel="stylesheet" id="mainstyle"></link>
	<meta charset="utf-8">
</head>
 
<body>

<header>
	<h1>Каталог продуктов</h1>
</header>

<nav>Поле фильтров</nav>

<div class="main">
		

</div>
	

<script type="text/javascript" id="observer"></script>
<script type="text/javascript" id="utilities"></script>
<script type="text/javascript" id="fetcher"></script>
<script type="text/javascript" id="base"></script>
<script type="text/javascript" id="cardmaker"></script>

<script type="text/javascript">

const data = {
	forLoad: {
		observer:	{attribute:	"src",	value:	"js/observer.js"},
		fetcher:	{attribute: "src",	value:	"js/fetcher.js"},
		utilities:	{attribute:	"src",	value:	"js/utilities.js"},
		base:		{attribute:	"src",	value:	"base.jsonp"},
		mainstyle:	{attribute:	"href",	value:	"css/mainstyle.css"},
		cardMaker:	{attribute: "src",	value:	"js/cardmaker.js"}
	}
};

function director( ) {
	base = JSON.parse( decodeURIComponent(base) ); /* определение переменной зашито в jsonp */
	let cards = new CardMaker(base.desc, document.querySelector(".main") );
	console.log(base.desc[5].pictureurl)
}
/*	* Класс LoadList контролирует загрузку элементов script, style и запускает
	* handler, когда все загружено успешно. 
	*
	* @constructor 
	*
	* @param list {Object} объект объектов. Структура: 
	*	myscript (id тега для загрузки): {attribute: "src, href и т.д.",	value:	"содержимое тега"}
	*
	* @param handler {Function} будет вызван, когда все объекты загрузятся. При 
	* 	отсутствии игнорируется, конструктор просто присвоит значения атрибутов тегам.
	*/
class LoadList {
	constructor(list, handler) {
		let element, attribute;
		this.length = Object.keys(list).length;
		this.loaded = 0;
		this.handler = handler;
		
		if (this.handler instanceof Function) { /* если нет корректного handler, не устанавливаем события */ 
			for(let i in list) {
				if (!list.hasOwnProperty(i)) continue;
				element = document.getElementById(i);
				attribute = list[i].attribute;
				if(!element) throw new Error(`loadList: got wrong id: ${i}`);		
				
				element.addEventListener("load", this.check.bind(this), false); /* bind т.к. вызов по событию от элемента ломает this*/	
			}
		}

		for(let i in list) {
			element = document.getElementById(i);
			attribute = list[i].attribute;
			if(!element) throw new Error(`loadList: got wrong id: ${i}`);
			if(!attribute) throw new Error(`loadList: there aren't attribute in given object. Key: ${i}`);
			if( element.hasAttribute(attribute) ) throw new Error(`loadList: the element ${element} id: "${i}" already has the attribute "${attribute}"`);
			
			element = document.getElementById(i);
			element.setAttribute(list[i].attribute, list[i].value);
		}

	}
	
	check( ) {
		this.loaded++;
		if (this.loaded === this.length && (this.handler instanceof Function) ) this.handler( );
	}
}

new LoadList(data.forLoad, director);

</script>

</body>
</html>
    