<!doctype HTML>
<html>
<head>
	<link rel="stylesheet" id="mainstyle"></link>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
 
<body>

<header>
	<h1>Каталог продуктов</h1>
</header>

<nav>Поле фильтров</nav>

<div class="main">
		

</div>
	

<script type="text/javascript" id="observer"></script>
<script type="text/javascript" id="utilities"></script>
<script type="text/javascript" id="fetcher"></script>
<script type="text/javascript" id="base"></script>
<script type="text/javascript" id="cardMaker"></script>

<script type="text/javascript">

const data = {
	forLoad: {
		observer:	{attribute:	"src",	value:	"js/observer.js",		loadControl: true},
		fetcher:	{attribute: "src",	value:	"js/fetcher.js",		loadControl: true},
		utilities:	{attribute:	"src",	value:	"js/utilities.js",		loadControl: true},
		base:		{attribute:	"src",	value:	"base.jsonp",			loadControl: true},
		mainstyle:	{attribute:	"href",	value:	"css/mainstyle.css",	loadControl: true},
		cardMaker:	{attribute: "src",	value: `js/cardMaker.js?${Math.random( )}`}
	}
};

function director( ) {
	base = JSON.parse( decodeURIComponent(base) ); /* определение переменной зашито в jsonp */
	let cards = new CardMaker(base.desc, document.querySelector(".main") );
	//console.log(base.desc[5].pictureurl)
}

class LoadList {
	constructor(list, handler) {
		let element, attribute;
		this.length = Object.keys(list).length;
		this.loaded = 0;
		this.handler = handler;
		for(let i in list) {
			if (!list.hasOwnProperty(i)) continue;
			element = document.getElementById(i);
			attribute = list[i].attribute;
		
			if(!element) throw new Error(`loadList: got wrong id: ${key}`);
			if(!attribute) throw new Error(`loadList: there aren't attribute in given object. Key: ${key}`);
			if( element.hasAttribute(attribute) ) throw new Error(`loadList: the element ${element} id: "${key}" already has the attribute "${attribute}"`);
		
			element.addEventListener("load", this.check.bind(this), false); /* bind т.к. вызов по событию от элемента ломает this*/	
		}

		for(let i in list) {
			element = document.getElementById(i);
			element.setAttribute(list[i].attribute, list[i].value);
		}

	}
	
	check( ) {
		this.loaded++
		if (this.loaded === this.length) this.handler( );
	}
}

new LoadList(data.forLoad, director);

</script>

</body>
</html>
    